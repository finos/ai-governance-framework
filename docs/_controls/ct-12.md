---
doc-status: Draft
sequence: 12
type:
 - Preventative
mitigates:
 -  TR‑2: Insufficient Access Control with Vector Store
 -  TR‑3: Lack of Source Data Access Controls
 -  TR‑9: Tampering with the Vector Store
 -  TR‑12: Ineffective Storage and Encryption
title: Role-based data access 
- Ensure data provided by Confluence is aligned with the end-user role.
- For data stored in encrypted file system, before a model/user/system tries to process and train/retrive the data, it has to prove its authentication and authorization, either through hardware-based or software-based attestation.

Objective
Enforce fine‑grained, end‑to‑end role‑based access controls so that only authorized identities can ingest, retrieve, modify, or decrypt data at any stage of the RAG pipeline.

Control Description
    Preserve Source Access Controls (TR‑3)
        Honor Confluence (and other source) permissions and metadata tags during ingestion.
        Block any attempt to index or embed documents for which the user’s role lacks read access .
    Restrict Vector Store Operations (TR‑2 & TR‑9)
        Query‑Time RBAC: Only allow vector lookups for embeddings tagged with the user’s role or group.
        Write‑Time RBAC: Limit add/update/delete privileges to designated service accounts or admins, preventing unauthorized tampering .
    Enforce Secure Storage & Attestation (TR‑12)
        Store all embeddings and documents in encrypted volumes using customer‑managed keys.
        Require hardware‑ or software‑based attestation (e.g., SGX, TPM, Nitro Enclaves) before issuing decryption keys or access tokens .

Implementation Guidance Examples: 
    Policy Engine: Use OPA/Gatekeeper (Rego) to enforce RBAC at both ingestion and query time.
    Metadata Tagging: Leverage Confluence labels or document classifications to drive per‑document access decisions.
    Vector Store Configuration: Configure namespace‑ or collection‑level RBAC in Pinecone, OpenSearch, or similar.
    Encryption & Attestation: Deploy encrypted storage with KMS‑backed keys and integrate remote attestation checks into your data access service.

Workflow possibility Examples: 
    Alice (role: Finance Analyst) submits a query to the RAG assistant.
    The middleware validates Alice’s JWT and checks her “Finance” role against the vector store namespace.
    Only embeddings tagged “Finance” are returned; any attempt to fetch “Engineering” embeddings is blocked.
    Before decryption, the host environment proves its integrity via TPM attestation—only then are the embeddings decrypted and returned.
